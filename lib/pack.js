// Generated by IcedCoffeeScript 1.6.2a
(function() {
  var e, mp, pp, set_opt, set_opts, _opts;



  try {
    mp = require('msgpack');
  } catch (_error) {
    e = _error;
  }

  if (mp == null) {
    try {
      mp = require('msgpack4');
    } catch (_error) {
      e = _error;
    }
  }

  if (mp == null) {
    try {
      pp = require('purepack');
    } catch (_error) {
      e = _error;
    }
  }

  if ((mp == null) && (pp == null)) {
    throw new Error("Need either msgpack, msgpack4 or purepack to run");
  }

  _opts = {};

  exports.set_opt = set_opt = function(k, v) {
    return _opts[k] = v;
  };

  exports.set_opts = set_opts = function(o) {
    return _opts = o;
  };

  exports.use_byte_arrays = function() {
    if (pp == null) {
      pp = require('purepack');
    }
    if (pp != null) {
      mp = null;
      return set_opt("byte_arrays", true);
    } else {
      throw new Error("Cannot use_byte_arrays without purepack!");
    }
  };

  exports.pack = function(b) {
    var ret;
    ret = mp ? mp.pack(b) : pp ? pp.pack(b, 'buffer', _opts) : void 0;
    return ret;
  };

  exports.unpack = function(b) {
    var dat, pw, _ref;
    pw = null;
    if (mp) {
      dat = mp.unpack(b);
    } else if (pp) {
      _ref = pp.unpack(b), pw = _ref[0], dat = _ref[1];
    }
    if (pw) {
      pw = pw.join("; ");
    }
    return [pw, dat];
  };

}).call(this);
